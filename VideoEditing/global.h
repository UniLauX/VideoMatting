#pragma once
#include "WmlMathLib.h"
#include "Vision/Image/cximage/include/cximage.h"
#include <vector>

#ifndef GLOBAL_LIB
#define GLOBAL_LIB
#define TEMP_DEBUG

double linear_interp(double low_value, double high_value, double position);

void derivation(CxImage &img, Wml::GMatrixd &dx, Wml::GMatrixd &dy);
void savedata(const BYTE *data, int width, int height, int wsize, int hsize, CxImage &img);
void reduce_image(Wml::GMatrixd &reduced, const Wml::GMatrixd &image);
void reduce_image(std::vector< std::vector<RGBQUAD> > &reduced, const std::vector< std::vector<RGBQUAD> > &image);
void project_image(std::vector< std::vector<int> > &proj, const std::vector< std::vector<int> > &img);
void reduce_image(std::vector< std::vector<int> > &reduced, const std::vector< std::vector<int> > &image);

void reduce_flow(Wml::GMatrixd &reduced, const Wml::GMatrixd &image);
void copy_image(Wml::GMatrixd &to, const Wml::GMatrixd &from);
void laplacian(Wml::GMatrixd &lap, const Wml::GMatrixd &image);
void wrap_image(Wml::GMatrixd &wrap, const Wml::GMatrixd &image, const Wml::GMatrixd &u, const Wml::GMatrixd &v);
void project_image(Wml::GMatrixd &proj, const Wml::GMatrixd &image);


const RGBQUAD color256[256] = 
{
	{0x00,0x00,0x00,0xFF},
	{0xFF,0x00,0x00,0xFF},
	{0xFF,0xFF,0x00,0xFF},
	{0x00,0xFF,0x00,0xFF},
	{0x00,0xFF,0xFF,0xFF},
	{0x00,0x00,0xFF,0xFF},
	{0xFF,0x00,0xFF,0xFF},
	{0xFF,0xFF,0xFF,0xFF},
	{0x80,0x80,0x80,0xFF},
	{0xC0,0xC0,0xC0,0xFF},
	{0xFF,0x00,0x00,0xFF},
	{0xFF,0x7F,0x7F,0xFF},
	{0xA5,0x00,0x00,0xFF},
	{0xA5,0x52,0x52,0xFF},
	{0x7F,0x00,0x00,0xFF},
	{0x7F,0x3F,0x3F,0xFF},
	{0x4C,0x00,0x00,0xFF},
	{0x4C,0x26,0x26,0xFF},
	{0x26,0x00,0x00,0xFF},
	{0x26,0x13,0x13,0xFF},
	{0xFF,0x3F,0x00,0xFF},
	{0xFF,0x9F,0x7F,0xFF},
	{0xA5,0x29,0x00,0xFF},
	{0xA5,0x67,0x52,0xFF},
	{0x7F,0x1F,0x00,0xFF},
	{0x7F,0x4F,0x3F,0xFF},
	{0x4C,0x13,0x00,0xFF},
	{0x4C,0x2F,0x26,0xFF},
	{0x26,0x09,0x00,0xFF},
	{0x26,0x17,0x13,0xFF},
	{0xFF,0x7F,0x00,0xFF},
	{0xFF,0xBF,0x7F,0xFF},
	{0xA5,0x52,0x00,0xFF},
	{0xA5,0x7C,0x52,0xFF},
	{0x7F,0x3F,0x00,0xFF},
	{0x7F,0x5F,0x3F,0xFF},
	{0x4C,0x26,0x00,0xFF},
	{0x4C,0x39,0x26,0xFF},
	{0x26,0x13,0x00,0xFF},
	{0x26,0x1C,0x13,0xFF},
	{0xFF,0xBF,0x00,0xFF},
	{0xFF,0xDF,0x7F,0xFF},
	{0xA5,0x7C,0x00,0xFF},
	{0xA5,0x91,0x52,0xFF},
	{0x7F,0x5F,0x00,0xFF},
	{0x7F,0x6F,0x3F,0xFF},
	{0x4C,0x39,0x00,0xFF},
	{0x4C,0x42,0x26,0xFF},
	{0x26,0x1C,0x00,0xFF},
	{0x26,0x21,0x13,0xFF},
	{0xFF,0xFF,0x00,0xFF},
	{0xFF,0xFF,0x7F,0xFF},
	{0xA5,0xA5,0x00,0xFF},
	{0xA5,0xA5,0x52,0xFF},
	{0x7F,0x7F,0x00,0xFF},
	{0x7F,0x7F,0x3F,0xFF},
	{0x4C,0x4C,0x00,0xFF},
	{0x4C,0x4C,0x26,0xFF},
	{0x26,0x26,0x00,0xFF},
	{0x26,0x26,0x13,0xFF},
	{0xBF,0xFF,0x00,0xFF},
	{0xDF,0xFF,0x7F,0xFF},
	{0x7C,0xA5,0x00,0xFF},
	{0x91,0xA5,0x52,0xFF},
	{0x5F,0x7F,0x00,0xFF},
	{0x6F,0x7F,0x3F,0xFF},
	{0x39,0x4C,0x00,0xFF},
	{0x42,0x4C,0x26,0xFF},
	{0x1C,0x26,0x00,0xFF},
	{0x21,0x26,0x13,0xFF},
	{0x7F,0xFF,0x00,0xFF},
	{0xBF,0xFF,0x7F,0xFF},
	{0x52,0xA5,0x00,0xFF},
	{0x7C,0xA5,0x52,0xFF},
	{0x3F,0x7F,0x00,0xFF},
	{0x5F,0x7F,0x3F,0xFF},
	{0x26,0x4C,0x00,0xFF},
	{0x39,0x4C,0x26,0xFF},
	{0x13,0x26,0x00,0xFF},
	{0x1C,0x26,0x13,0xFF},
	{0x3F,0xFF,0x00,0xFF},
	{0x9F,0xFF,0x7F,0xFF},
	{0x29,0xA5,0x00,0xFF},
	{0x67,0xA5,0x52,0xFF},
	{0x1F,0x7F,0x00,0xFF},
	{0x4F,0x7F,0x3F,0xFF},
	{0x13,0x4C,0x00,0xFF},
	{0x2F,0x4C,0x26,0xFF},
	{0x09,0x26,0x00,0xFF},
	{0x17,0x26,0x13,0xFF},
	{0x00,0xFF,0x00,0xFF},
	{0x7F,0xFF,0x7F,0xFF},
	{0x00,0xA5,0x00,0xFF},
	{0x52,0xA5,0x52,0xFF},
	{0x00,0x7F,0x00,0xFF},
	{0x3F,0x7F,0x3F,0xFF},
	{0x00,0x4C,0x00,0xFF},
	{0x26,0x4C,0x26,0xFF},
	{0x00,0x26,0x00,0xFF},
	{0x13,0x26,0x13,0xFF},
	{0x00,0xFF,0x3F,0xFF},
	{0x7F,0xFF,0x9F,0xFF},
	{0x00,0xA5,0x29,0xFF},
	{0x52,0xA5,0x67,0xFF},
	{0x00,0x7F,0x1F,0xFF},
	{0x3F,0x7F,0x4F,0xFF},
	{0x00,0x4C,0x13,0xFF},
	{0x26,0x4C,0x2F,0xFF},
	{0x00,0x26,0x09,0xFF},
	{0x13,0x26,0x17,0xFF},
	{0x00,0xFF,0x7F,0xFF},
	{0x7F,0xFF,0xBF,0xFF},
	{0x00,0xA5,0x52,0xFF},
	{0x52,0xA5,0x7C,0xFF},
	{0x00,0x7F,0x3F,0xFF},
	{0x3F,0x7F,0x5F,0xFF},
	{0x00,0x4C,0x26,0xFF},
	{0x26,0x4C,0x39,0xFF},
	{0x00,0x26,0x13,0xFF},
	{0x13,0x26,0x1C,0xFF},
	{0x00,0xFF,0xBF,0xFF},
	{0x7F,0xFF,0xDF,0xFF},
	{0x00,0xA5,0x7C,0xFF},
	{0x52,0xA5,0x91,0xFF},
	{0x00,0x7F,0x5F,0xFF},
	{0x3F,0x7F,0x6F,0xFF},
	{0x00,0x4C,0x39,0xFF},
	{0x26,0x4C,0x42,0xFF},
	{0x00,0x26,0x1C,0xFF},
	{0x13,0x26,0x21,0xFF},
	{0x00,0xFF,0xFF,0xFF},
	{0x7F,0xFF,0xFF,0xFF},
	{0x00,0xA5,0xA5,0xFF},
	{0x52,0xA5,0xA5,0xFF},
	{0x00,0x7F,0x7F,0xFF},
	{0x3F,0x7F,0x7F,0xFF},
	{0x00,0x4C,0x4C,0xFF},
	{0x26,0x4C,0x4C,0xFF},
	{0x00,0x26,0x26,0xFF},
	{0x13,0x26,0x26,0xFF},
	{0x00,0xBF,0xFF,0xFF},
	{0x7F,0xDF,0xFF,0xFF},
	{0x00,0x7C,0xA5,0xFF},
	{0x52,0x91,0xA5,0xFF},
	{0x00,0x5F,0x7F,0xFF},
	{0x3F,0x6F,0x7F,0xFF},
	{0x00,0x39,0x4C,0xFF},
	{0x26,0x42,0x4C,0xFF},
	{0x00,0x1C,0x26,0xFF},
	{0x13,0x21,0x26,0xFF},
	{0x00,0x7F,0xFF,0xFF},
	{0x7F,0xBF,0xFF,0xFF},
	{0x00,0x52,0xA5,0xFF},
	{0x52,0x7C,0xA5,0xFF},
	{0x00,0x3F,0x7F,0xFF},
	{0x3F,0x5F,0x7F,0xFF},
	{0x00,0x26,0x4C,0xFF},
	{0x26,0x39,0x4C,0xFF},
	{0x00,0x13,0x26,0xFF},
	{0x13,0x1C,0x26,0xFF},
	{0x00,0x3F,0xFF,0xFF},
	{0x7F,0x9F,0xFF,0xFF},
	{0x00,0x29,0xA5,0xFF},
	{0x52,0x67,0xA5,0xFF},
	{0x00,0x1F,0x7F,0xFF},
	{0x3F,0x4F,0x7F,0xFF},
	{0x00,0x13,0x4C,0xFF},
	{0x26,0x2F,0x4C,0xFF},
	{0x00,0x09,0x26,0xFF},
	{0x13,0x17,0x26,0xFF},
	{0x00,0x00,0xFF,0xFF},
	{0x7F,0x7F,0xFF,0xFF},
	{0x00,0x00,0xA5,0xFF},
	{0x52,0x52,0xA5,0xFF},
	{0x00,0x00,0x7F,0xFF},
	{0x3F,0x3F,0x7F,0xFF},
	{0x00,0x00,0x4C,0xFF},
	{0x26,0x26,0x4C,0xFF},
	{0x00,0x00,0x26,0xFF},
	{0x13,0x13,0x26,0xFF},
	{0x3F,0x00,0xFF,0xFF},
	{0x9F,0x7F,0xFF,0xFF},
	{0x29,0x00,0xA5,0xFF},
	{0x67,0x52,0xA5,0xFF},
	{0x1F,0x00,0x7F,0xFF},
	{0x4F,0x3F,0x7F,0xFF},
	{0x13,0x00,0x4C,0xFF},
	{0x2F,0x26,0x4C,0xFF},
	{0x09,0x00,0x26,0xFF},
	{0x17,0x13,0x26,0xFF},
	{0x7F,0x00,0xFF,0xFF},
	{0xBF,0x7F,0xFF,0xFF},
	{0x52,0x00,0xA5,0xFF},
	{0x7C,0x52,0xA5,0xFF},
	{0x3F,0x00,0x7F,0xFF},
	{0x5F,0x3F,0x7F,0xFF},
	{0x26,0x00,0x4C,0xFF},
	{0x39,0x26,0x4C,0xFF},
	{0x13,0x00,0x26,0xFF},
	{0x1C,0x13,0x26,0xFF},
	{0xBF,0x00,0xFF,0xFF},
	{0xDF,0x7F,0xFF,0xFF},
	{0x7C,0x00,0xA5,0xFF},
	{0x91,0x52,0xA5,0xFF},
	{0x5F,0x00,0x7F,0xFF},
	{0x6F,0x3F,0x7F,0xFF},
	{0x39,0x00,0x4C,0xFF},
	{0x42,0x26,0x4C,0xFF},
	{0x1C,0x00,0x26,0xFF},
	{0x21,0x13,0x26,0xFF},
	{0xFF,0x00,0xFF,0xFF},
	{0xFF,0x7F,0xFF,0xFF},
	{0xA5,0x00,0xA5,0xFF},
	{0xA5,0x52,0xA5,0xFF},
	{0x7F,0x00,0x7F,0xFF},
	{0x7F,0x3F,0x7F,0xFF},
	{0x4C,0x00,0x4C,0xFF},
	{0x4C,0x26,0x4C,0xFF},
	{0x26,0x00,0x26,0xFF},
	{0x26,0x13,0x26,0xFF},
	{0xFF,0x00,0xBF,0xFF},
	{0xFF,0x7F,0xDF,0xFF},
	{0xA5,0x00,0x7C,0xFF},
	{0xA5,0x52,0x91,0xFF},
	{0x7F,0x00,0x5F,0xFF},
	{0x7F,0x3F,0x6F,0xFF},
	{0x4C,0x00,0x39,0xFF},
	{0x4C,0x26,0x42,0xFF},
	{0x26,0x00,0x1C,0xFF},
	{0x26,0x13,0x21,0xFF},
	{0xFF,0x00,0x7F,0xFF},
	{0xFF,0x7F,0xBF,0xFF},
	{0xA5,0x00,0x52,0xFF},
	{0xA5,0x52,0x7C,0xFF},
	{0x7F,0x00,0x3F,0xFF},
	{0x7F,0x3F,0x5F,0xFF},
	{0x4C,0x00,0x26,0xFF},
	{0x4C,0x26,0x39,0xFF},
	{0x26,0x00,0x13,0xFF},
	{0x26,0x13,0x1C,0xFF},
	{0xFF,0x00,0x3F,0xFF},
	{0xFF,0x7F,0x9F,0xFF},
	{0xA5,0x00,0x29,0xFF},
	{0xA5,0x52,0x67,0xFF},
	{0x7F,0x00,0x1F,0xFF},
	{0x7F,0x3F,0x4F,0xFF},
	{0x4C,0x00,0x13,0xFF},
	{0x4C,0x26,0x2F,0xFF},
	{0x26,0x00,0x09,0xFF},
	{0x26,0x13,0x17,0xFF},
	{0x00,0x00,0x00,0xFF},
	{0x33,0x33,0x33,0xFF},
	{0x66,0x66,0x66,0xFF},
	{0x99,0x99,0x99,0xFF},
	{0xCC,0xCC,0xCC,0xFF},
	{0xFF,0xFF,0xFF,0xFF}
};

#endif